#!/bin/bash

# get user inputs
echo -e "\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n."

echo -e "\nEnter new password:\n"
read -r userPassword
echo -e "\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n."

echo -e "\nEnter desired timezone in format of Country/City (Timezones can be listed by switching to a different console using Alt+F2, logging in as root, and issuing command \"timedatectl list-timezones\") (Switch back to this console with Alt+F1):\n"
read -r timeZone
echo -e "\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n.\n."

echo -e "\nDone\n"
sleep 2
echo -e "\nInstalling KDE Plasma\n"
sleep 2










# configure system

# set password
echo -e "\nSetting password\n"
sleep 2
echo -e "raspberry\n$userPassword\n$userPassword" | passwd 
echo -e "\nDone\n"
sleep 2


# set the time and language
echo -e "\nSetting time and language\n"
sleep 2
sudo ln -sf /usr/share/zoneinfo/"$timeZone" /etc/localtime
sudo sed -i 's/en_GB.UTF-8/# en_GB.UTF-8/' /etc/locale.gen
sudo sed -i 's/# en_US.UTF-8/en_US.UTF-8/' /etc/locale.gen
sudo locale-gen
sudo sed -i 's/gb/us/' /etc/default/keyboard
echo -e "\nDone\n"
sleep 2


# configure bash
echo -e "\nConfiguring bash\n"
sleep 2
sudo echo -e "export PS1='\[$(tput bold)\]\[\033[38;5;6m\][\[$(tput sgr0)\]\[\033[38;5;2m\]\u\[$(tput sgr0)\]\[\033[38;5;6m\]@\[$(tput sgr0)\]\[\033[38;5;2m\]\h\[$(tput sgr0)\] \[$(tput sgr0)\]\[$(tput bold)\]\[\033[38;5;208m\]\W\[$(tput sgr0)\]\[\033[38;5;6m\]]\[$(tput sgr0)\]\[\033[38;5;201m\]\\$\[$(tput sgr0)\] \[$(tput sgr0)\]'" >> /home/pi/.bashrc
sudo echo -e "\n# Enables auto-correct" >> /home/pi/.bashrc
sudo echo -e "shopt -s cdspell" >> /home/pi/.bashrc
sudo echo -e "\n# Enables color" >> /home/pi/.bashrc
sudo echo -e "alias diff='diff --color=auto'" >> /home/pi/.bashrc
sudo echo -e "alias grep='grep --color=auto'" >> /home/pi/.bashrc
sudo echo -e "alias ip='ip -color=auto'" >> /home/pi/.bashrc
sudo echo -e "alias ls='ls --color=auto'" >> /home/pi/.bashrc
sudo echo -e "alias sudo='sudo '" >> /home/pi/.bashrc
sudo echo -e "export LESS_TERMCAP_mb=$'\e[1;32m'" >> /home/pi/.bashrc
sudo echo -e "export LESS_TERMCAP_md=$'\e[1;32m'" >> /home/pi/.bashrc
sudo echo -e "export LESS_TERMCAP_me=$'\e[0m'" >> /home/pi/.bashrc
sudo echo -e "export LESS_TERMCAP_se=$'\e[0m'" >> /home/pi/.bashrc
sudo echo -e "export LESS_TERMCAP_so=$'\e[01;33m'" >> /home/pi/.bashrc
sudo echo -e "export LESS_TERMCAP_ue=$'\e[0m'" >> /home/pi/.bashrc
sudo echo -e "export LESS_TERMCAP_us=$'\e[1;4;31m'" >> /home/pi/.bashrc
sudo echo -e "\n# Rewrap text on window resize" >> /home/pi/.bashrc
sudo echo -e "shopt -s checkwinsize" >> /home/pi/.bashrc
sudo echo -e "\n# apt alias" >> /home/pi/.bashrc
sudo echo -e "alias apt-update='sudo apt update && sudo apt full-upgrade'" >> /home/pi/.bashrc
echo -e "\nDone\n"
sleep 2










# install packages
echo -e "\nInstalling packages\n"
sleep 2
sudo apt install kde-plasma-desktop guake flatpak vlc bat qbittorrent kate rpi-imager plasma-systemmonitor
sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
echo -e "\nDone\n"
sleep 2










# reboot
echo -e "\nRebooting in 5 seconds\n"
sleep 5
reboot
